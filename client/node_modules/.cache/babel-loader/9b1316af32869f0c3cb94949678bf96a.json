{"ast":null,"code":"import _slicedToArray from\"C:/Users/\\u044E\\u0437\\u0435\\u0440/Downloads/diplom/diplom/reactapp/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useRef,useEffect}from\"react\";import\"./audioPlayer.css\";import Controls from\"./controls\";import ProgressCircle from\"./progressCircle\";import WaveAnimation from\"./waveAnimation\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function AudioPLayer(_ref){var _total$currentIndex,_total$,_currentTrack$album,_currentTrack$album2,_currentTrack$album2$;var currentTrack=_ref.currentTrack,currentIndex=_ref.currentIndex,setCurrentIndex=_ref.setCurrentIndex,total=_ref.total;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isPlaying=_useState2[0],setIsPlaying=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),trackProgress=_useState4[0],setTrackProgress=_useState4[1];var audioSrc=(_total$currentIndex=total[currentIndex])===null||_total$currentIndex===void 0?void 0:_total$currentIndex.track.preview_url;var audioRef=useRef(new Audio((_total$=total[0])===null||_total$===void 0?void 0:_total$.track.preview_url));var intervalRef=useRef();var isReady=useRef(false);var duration=audioRef.current.duration;var currentPercentage=duration?trackProgress/duration*100:0;var startTimer=function startTimer(){clearInterval(intervalRef.current);intervalRef.current=setInterval(function(){if(audioRef.current.ended){handleNext();}else{setTrackProgress(audioRef.current.currentTime);}},[1000]);};useEffect(function(){if(audioRef.current.src){if(isPlaying){audioRef.current.play();startTimer();}else{clearInterval(intervalRef.current);audioRef.current.pause();}}else{if(isPlaying){audioRef.current=new Audio(audioSrc);audioRef.current.play();startTimer();}else{clearInterval(intervalRef.current);audioRef.current.pause();}}},[isPlaying]);useEffect(function(){audioRef.current.pause();audioRef.current=new Audio(audioSrc);setTrackProgress(audioRef.current.currentTime);if(isReady.current){audioRef.current.play();setIsPlaying(true);startTimer();}else{isReady.current=true;}},[currentIndex]);useEffect(function(){return function(){audioRef.current.pause();clearInterval(intervalRef.current);};},[]);var handleNext=function handleNext(){if(currentIndex<total.length-1){setCurrentIndex(currentIndex+1);}else setCurrentIndex(0);};var handlePrev=function handlePrev(){if(currentIndex-1<0)setCurrentIndex(total.length-1);else setCurrentIndex(currentIndex-1);};var addZero=function addZero(n){return n>9?\"\"+n:\"0\"+n;};var artists=[];currentTrack===null||currentTrack===void 0?void 0:(_currentTrack$album=currentTrack.album)===null||_currentTrack$album===void 0?void 0:_currentTrack$album.artists.forEach(function(artist){artists.push(artist.name);});return/*#__PURE__*/_jsxs(\"div\",{className:\"player-body flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"player-left-body\",children:/*#__PURE__*/_jsx(ProgressCircle,{percentage:currentPercentage,isPlaying:true,image:currentTrack===null||currentTrack===void 0?void 0:(_currentTrack$album2=currentTrack.album)===null||_currentTrack$album2===void 0?void 0:(_currentTrack$album2$=_currentTrack$album2.images[0])===null||_currentTrack$album2$===void 0?void 0:_currentTrack$album2$.url,size:300,color:\"#C96850\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"player-right-body flex\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"song-title\",children:currentTrack===null||currentTrack===void 0?void 0:currentTrack.name}),/*#__PURE__*/_jsx(\"p\",{className:\"song-artist\",children:artists.join(\" | \")}),/*#__PURE__*/_jsxs(\"div\",{className:\"player-right-bottom flex\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"song-duration flex\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"duration\",children:[\"0:\",addZero(Math.round(trackProgress))]}),/*#__PURE__*/_jsx(WaveAnimation,{isPlaying:isPlaying}),/*#__PURE__*/_jsx(\"p\",{className:\"duration\",children:\"0:30\"})]}),/*#__PURE__*/_jsx(Controls,{isPlaying:isPlaying,setIsPlaying:setIsPlaying,handleNext:handleNext,handlePrev:handlePrev,total:total})]})]})]});}","map":{"version":3,"sources":["C:/Users/юзер/Downloads/diplom/diplom/reactapp/client/src/components/audioPlayer/index.js"],"names":["React","useState","useRef","useEffect","Controls","ProgressCircle","WaveAnimation","AudioPLayer","currentTrack","currentIndex","setCurrentIndex","total","isPlaying","setIsPlaying","trackProgress","setTrackProgress","audioSrc","track","preview_url","audioRef","Audio","intervalRef","isReady","duration","current","currentPercentage","startTimer","clearInterval","setInterval","ended","handleNext","currentTime","src","play","pause","length","handlePrev","addZero","n","artists","album","forEach","artist","push","name","images","url","join","Math","round"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport \"./audioPlayer.css\";\nimport Controls from \"./controls\";\nimport ProgressCircle from \"./progressCircle\";\nimport WaveAnimation from \"./waveAnimation\";\n\nexport default function AudioPLayer({\n  currentTrack,\n  currentIndex,\n  setCurrentIndex,\n  total,\n}) {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [trackProgress, setTrackProgress] = useState(0);\n  var audioSrc = total[currentIndex]?.track.preview_url;\n\n  const audioRef = useRef(new Audio(total[0]?.track.preview_url));\n\n  const intervalRef = useRef();\n\n  const isReady = useRef(false);\n\n  const { duration } = audioRef.current;\n\n  const currentPercentage = duration ? (trackProgress / duration) * 100 : 0;\n\n  const startTimer = () => {\n    clearInterval(intervalRef.current);\n\n    intervalRef.current = setInterval(() => {\n      if (audioRef.current.ended) {\n        handleNext();\n      } else {\n        setTrackProgress(audioRef.current.currentTime);\n      }\n    }, [1000]);\n  };\n\n  useEffect(() => {\n    if (audioRef.current.src) {\n      if (isPlaying) {\n        audioRef.current.play();\n        startTimer();\n      } else {\n        clearInterval(intervalRef.current);\n        audioRef.current.pause();\n      }\n    } else {\n      if (isPlaying) {\n        audioRef.current = new Audio(audioSrc);\n        audioRef.current.play();\n        startTimer();\n      } else {\n        clearInterval(intervalRef.current);\n        audioRef.current.pause();\n      }\n    }\n  }, [isPlaying]);\n\n  useEffect(() => {\n    audioRef.current.pause();\n    audioRef.current = new Audio(audioSrc);\n\n    setTrackProgress(audioRef.current.currentTime);\n\n    if (isReady.current) {\n      audioRef.current.play();\n      setIsPlaying(true);\n      startTimer();\n    } else {\n      isReady.current = true;\n    }\n  }, [currentIndex]);\n\n  useEffect(() => {\n    return () => {\n      audioRef.current.pause();\n      clearInterval(intervalRef.current);\n    };\n  }, []);\n\n  const handleNext = () => {\n    if (currentIndex < total.length - 1) {\n      setCurrentIndex(currentIndex + 1);\n    } else setCurrentIndex(0);\n  };\n\n  const handlePrev = () => {\n    if (currentIndex - 1 < 0) setCurrentIndex(total.length - 1);\n    else setCurrentIndex(currentIndex - 1);\n  };\n\n  const addZero = (n) => {\n    return n > 9 ? \"\" + n : \"0\" + n;\n  };\n  const artists = [];\n  currentTrack?.album?.artists.forEach((artist) => {\n    artists.push(artist.name);\n  });\n  return (\n    <div className=\"player-body flex\">\n      <div className=\"player-left-body\">\n        <ProgressCircle\n          percentage={currentPercentage}\n          isPlaying={true}\n          image={currentTrack?.album?.images[0]?.url}\n          size={300}\n          color=\"#C96850\"\n        />\n      </div>\n      <div className=\"player-right-body flex\">\n        <p className=\"song-title\">{currentTrack?.name}</p>\n        <p className=\"song-artist\">{artists.join(\" | \")}</p>\n        <div className=\"player-right-bottom flex\">\n          <div className=\"song-duration flex\">\n            <p className=\"duration\">0:{addZero(Math.round(trackProgress))}</p>\n            <WaveAnimation isPlaying={isPlaying} />\n            <p className=\"duration\">0:30</p>\n          </div>\n          <Controls\n            isPlaying={isPlaying}\n            setIsPlaying={setIsPlaying}\n            handleNext={handleNext}\n            handlePrev={handlePrev}\n            total={total}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}